<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="/admin/img/apple-icon.png">
  <link rel="icon" type="image/png" href="/admin/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Vibrant Meals Admin
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="/admin/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/admin/css/paper-dashboard.css?v=2.0.0" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="/admin/demo/demo.css" rel="stylesheet" />
  <link rel="stylesheet" href="/css/toastr.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.18/b-1.5.6/b-colvis-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/r-2.2.2/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.css" />
  <link rel="stylesheet" href="/css/bootstrap-tags.css" />
  <link rel="stylesheet" href="/css/custom-toggle.css" />
<style>
  body {
    overflow-x: hidden;
  }
  span.mr-10 {
    margin-right: 10em;
}
input.muted {
    border: none;
    border-bottom: .5px solid gainsboro;
    background: #f2f2f2;
    padding: 10px;
    border-radius: 10px;
}



.modal-body.text-md {
    font-size: 1.33rem;
}

#loading {
  display: inline-block;
  width: 25px;
  height: 25px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
  -webkit-animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { -webkit-transform: rotate(360deg); }
}
@-webkit-keyframes spin {
  to { -webkit-transform: rotate(360deg); }
}

#category-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    width: 100%;
    /* min-height: 50px; */
    /* max-height: 100px; */
    /* padding: 20px; */
}

#category-container .img-container:hover > h2 {
  border-radius: 0px;
  text-decoration: underline;
}
#category-container .img-container .icon {
  position: relative;
  width: 27px;
  /* margin-top: 15%; */
}
#category-container h2 {
  font-weight: 300;
}
.card-stats .card-body .numbers {
  font-size: 14px;
}
div#admin-bar {
    flex-basis: 70%;
}

.navbar.navbar-transparent a:not(.dropdown-item):not(.btn).active {
    color: green;
}
.navbar.navbar-transparent a:not(.dropdown-item):not(.btn):hover {
    color: green;
}

.dt-buttons {
  flex-wrap: wrap;
}

svg.feather.feather-plus {
    height: 50px;
    width: 50px;
    background: #6ad098;
    border-radius: 10em;
    color: white;
}
</style>
</head>

<body class="">

  <div class="wrapper ">
    <div class="sidebar" data-color="white" data-active-color="success">
      <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red | yellow"
    -->
      <div class="logo">
        <a href="/" class="simple-text logo-mini">
          <div class="logo-image-small">
            <img src="/admin/img/logo-small.png">
          </div>
        </a>
        <a href="/" class="simple-text logo-normal">
          {{auth.user.name}}
          <!-- <div class="logo-image-big">
            <img src="/admin/img/logo-big.png">
          </div> -->
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="">
            <a href="/admin/dashboard">
              <i class="nc-icon nc-bank"></i>
              <p>Dashboard</p>
            </a>
          </li>
          <li class="">
            <a href="/admin/orders">
              <i class="nc-icon nc-money-coins"></i>
              <p>Orders</p>
            </a>
          </li>
          <li class="">
              
            <a data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
              <i class="nc-icon nc-minimal-down"></i>
              <p>Inventory/Products</p>
            </a>
          </li>
          
          <li class="collapse" id="collapseExample" style="background-color:#dcdcdc66;border-top:1px solid #ddd;border-bottom:1px solid #ddd;">
              <a href="/admin/products">
                <i class="nc-icon nc-ruler-pencil success" data-active-color="success"></i>
                <p>View/Edit</p>
              </a>
              <a href="/products/add">
                <i class="nc-icon nc-simple-add"></i>
                <p>Add New</p>
              </a>
              <a href="/test/items">
                <i class="nc-icon nc-zoom-split"></i>
                <p>View Menu</p>
              </a>
          </li>

          <li class="">
              
              <a data-toggle="collapse" href="#promotions" role="button" aria-expanded="false" aria-controls="promotions">
                <i class="nc-icon nc-tag-content"></i>
                <p>Promotions</p>
              </a>
            </li>
            
            <li class="collapse" id="promotions" style="background-color:#dcdcdc66;border-top:1px solid #ddd;border-bottom:1px solid #ddd;">
                <a href="/admin/coupon">
                  <i class="nc-icon nc-zoom-split success" data-active-color="success"></i>
                  <p>View Coupons</p>
                </a>
                <a href="#" data-toggle="modal" data-target="#couponModal">
                  <i class="nc-icon nc-simple-add"></i>
                  <p>Add Coupon</p>
                </a>
            </li>
            <li>
                <a href="/admin/locations">
                  <i class="nc-icon nc-pin-3"></i>
                  <p>Locations</p>
                </a>
              </li>
          <li>
            <a href="/admin/customers">
              <i class="nc-icon nc-single-02"></i>
              <p>Customers</p>
            </a>
          </li>
          <li>
            <a href="./user.html">
              <i class="nc-icon nc-sound-wave"></i>
              <p>Analytics</p>
            </a>
          </li>

          <li class="">
              
              <a data-toggle="collapse" href="#forms" role="button" aria-expanded="false" aria-controls="forms">
                <i class="nc-icon nc-tag-content"></i>
                <p>Forms</p>
              </a>
            </li>
            
            <li class="collapse" id="forms" style="background-color:#dcdcdc66;border-top:1px solid #ddd;border-bottom:1px solid #ddd;">
                
              <a href="/admin/forms/contact">
                  <i class="nc-icon nc-zoom-split success" data-active-color="success"></i>
                  <p>Contact Form</p>
                </a>
                <a href="/admin/forms/catering">
                  <i class="nc-icon nc-simple-add"></i>
                  <p>Catering</p>
                </a>
                <a href="/admin/forms/careers">
                  <i class="nc-icon nc-simple-add"></i>
                  <p>Careers</p>
                </a>
                <a href="/admin/forms/partnerships">
                  <i class="nc-icon nc-simple-add"></i>
                  <p>Partnerships</p>
                </a>
            </li>
          <li>
            <a href="./tables.html">
              <i class="nc-icon nc-tile-56"></i>
              <p>Settings</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <div class="navbar-toggle">
              <button type="button" class="navbar-toggler">
                <span class="navbar-toggler-bar bar1"></span>
                <span class="navbar-toggler-bar bar2"></span>
                <span class="navbar-toggler-bar bar3"></span>
              </button>
            </div>
          </div>
          <div id="admin-bar"></div>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
            <span class="navbar-toggler-bar navbar-kebab"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end" id="navigation">
<!--            <form>
              <div class="input-group no-border">
                <input type="text" value="" class="form-control" id="searchBar" placeholder="Search...">
                <div class="input-group-append">
                  <div class="input-group-text">
                    <i class="nc-icon nc-zoom-split"></i>
                  </div>
                </div>
              </div>
            </form>
          -->
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link btn-magnify" href="/menu">
                  <i class="nc-icon nc-layout-11"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Stats</span>
                  </p>
                </a>
              </li>
              <li class="nav-item btn-rotate dropdown">
                <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="nc-icon nc-bell-55"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Some Actions</span>
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="#">Action</a>
                  <a class="dropdown-item" href="#">Another action</a>
                  <a class="dropdown-item" href="#">Something else here</a>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link btn-rotate" href="#pablo">
                  <i class="nc-icon nc-settings-gear-65"></i>
                  <p>
                    <span class="d-lg-none d-md-block">Account</span>
                  </p>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <!-- <div class="panel-header panel-header-lg">
  
  <canvas id="bigDashboardChart"></canvas>
  
  
</div> -->
@!section('content')


<script src="/admin/js/core/jquery.min.js"></script>
<script src="/admin/js/core/popper.min.js"></script>
<script src="/admin/js/core/bootstrap.min.js"></script>
<script src="/admin/js/plugins/perfect-scrollbar.jquery.min.js"></script>
<!-- Chart JS -->
<script src="/admin/js/plugins/chartjs.min.js"></script>
<!--  Notifications Plugin    -->
<script src="/admin/js/plugins/bootstrap-notify.js"></script>
<script src="/js/moment.min.js"></script>
<script src="/js/combodate.min.js"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<script src="/admin/js/paper-dashboard.min.js?v=2.0.0" type="text/javascript"></script>
<!-- Paper Dashboard DEMO methods, don't include it in your project! -->
<script src="/admin/demo/demo.js"></script>

<script src="https://cdn.jsdelivr.net/bootstrap.tagsinput/0.8.0/bootstrap-tagsinput.min.js"></script>

<script src="https://unpkg.com/feather-icons"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.18/b-1.5.6/b-colvis-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/r-2.2.2/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.js"></script>
<script type="text/javascript" src="/admin/js/scheduled-orders-table.js"></script>
<script src="/js/mask-money.js"></script>

<script>
  
  $.getScript('//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js', function(){
  toastr.options = {
  "closeButton": false,
  "debug": false,
  "newestOnTop": false,
  "progressBar": false,
  "positionClass": "toast-top-right",
  "preventDuplicates": true,
  "onclick": null,
  "showDuration": "300",
  "hideDuration": "1000",
  "timeOut": "5000",
  "extendedTimeOut": "1000",
  "showEasing": "swing",
  "hideEasing": "linear",
  "showMethod": "fadeIn",
  "hideMethod": "fadeOut"
}
})
  $('#addCoupon').on('click', function(){
  
    $.ajax({
          type: 'POST',
          url: '/admin/coupon/add',
          data: $('#couponCodeAdd').serialize(),

          success: function(data){
            console.log(JSON.stringify(data))
            if (data.includes('already exists')) {
              toastr["error"](data)

            } else {
              toastr["success"](data)
              $('.modal').modal('toggle')

            }


          },
          failure: function(errMsg) {
            console.log(JSON.stringify(errMsg))
            // return alert(JSON.stringify(errMsg));
          }
      })
  })

  $('.delete-coupon').on('click', function(){
    var data = $(this).data()

  })
  
  $('input[name=switch]').on('change', function(){
    var active = $('#switch-on').is(':checked')
    var inactive = $('#switch-off').is(':checked')
    if (active) {
      $('.false').hide()
      $('.true').show()
    }

    if (inactive) {
      $('.true').hide()
      $('.false').show()

    }

  })

  $(document).ready(function() {
    $('.false').hide()
    $(".filter-button").click(function(){
      var value = $(this).attr('data-filter');
      $('.filter-button').removeClass('active')
      $(this).addClass('active')
      
      if(value == "all")
      {
          $('.filter').show('1000');
      }
      else
      {
          $(".filter").not('.'+value).hide('3000');
          $('.filter').filter('.'+value).show('3000'); 
          if ($('#switch-on').is(':checked')) {
            $('.false').hide()
            
          }
      }
  });

  $(".filter-button-visibility").click(function(){
      var value = $(this).attr('data-filter');
      $('.filter-button-visibility').removeClass('active')
      $(this).addClass('active')
      
      if(value == "all")
      {
          $('.filter').show('1000');
      }
      else
      {
          $(".filter").not('.'+value).hide('3000');
          $('.filter').filter('.'+value).show('3000'); 
          if ($('#switch-on').is(':checked')) {
            $('.false').hide()
            
          }
      }
  });



    $('#productNeeded, #customers', '#productNeededExport').DataTable( {
        select: true,
        dom: 'Bfrtip',
        colReorder: true,
        buttons: [
          'csv',
          'pdfHtml5',
          'selectAll',
          'selectNone'
        ]
    } );

    $('#locations').DataTable( {
          select: false,
          dom: 'Bfrtip',
          colReorder: true,
          columnDefs: [
            {'width': '10%'}
          ],
          buttons: [
            'csv',
            'pdfHtml5',

            {
              text: 'Add Location',
              className: 'btn-success',
              action: function () {
                $('.add-locations-modal').modal('toggle')
              }
            }
          ]
      } );
      // $('#opens, #closes').combodate()
} );
$('.update-billing').on('click', function(){
		console.log('hello')
    console.log($('form#billing').serialize())
    $.ajax({
      type: "POST",
      url: "/account/billing/update",
      data: $('form#billing').serialize(),
      dataType: "json",
        success: function(data){
            console.log('success');
        },
        failure: function(errMsg) {
            alert(JSON.stringify(errMsg));
        }

    })

  })
 
  $('#demo1').maskMoney()
  function convertCurrent(amount) {
    var key = event.keyCode || event.charCode;

    if( key == 8 || key == 46 )
        return false;
    
  var amount = parseInt(amount)
  var i = parseFloat(amount);
  console.log(i)
	if(isNaN(i)) { i = 0.00; }
	var minus = '';
	if(i < 0) { minus = '-'; }
	i = Math.abs(i);
	i = parseInt((i + .005) * 100);
	i = i / 100;
	s = new String(i);
	if(s.indexOf('.') < 0) { s += '.00'; }
	if(s.indexOf('.') == (s.length - 2)) { s += '0'; }
	s = minus + s;
  
  $('input').val(s).trigger('change')
}

  $('.issue-custom-refund').on('click', function(){
    var data = $(this).data()
    var v = $('#demo1')


    if (v.val() != "") {
      data.amount = v.val().replace('.', '')
    } else {
      data.amount = v.attr('placeholder').replace('$', '').replace('.', '')
    }
      $.ajax({
      type: 'POST',
      url: '/admin/orders/update/refund',
      data: data,
      success: function(){
        toastr['success']('Order modified successfully')
      },
      error: function() {
        toastr['warning']('Something went wrong, try again')
      }
    })
  })
$('.order-details-update').on('click', function(){
  var data = $(this).data()

  var req = {
    id: data.order,
    status: data.status,
  }

  toastr['success'](req)
  $.ajax({
    type: 'POST',
    url: '/admin/orders/update',
    data: req,
    success: function(){
      toastr['success']('Order modified successfully')
    },
    error: function() {
      toastr['warning']('Something went wrong, try again')
    }
  })
})

function convertCamelToInitials(string) {
       return string.replace(/[\w]([A-Z])/g, function(m) {
           return m[0] + "_" + m[1];
       }).toLowerCase();
   }


feather.replace()
function updateSkuLabel(id, value) {
  if (convertCamelToInitials(value).includes('_')) {
    value = convertCamelToInitials(value).split('_')
    value = value[0][0].toUpperCase() + value[1][0].toUpperCase()
  } else {
    value = value.split("")[0].toUpperCase()
  }

   $('input[name=product_id]').val(value + '_' + $('input[id=productName]').val().toLowerCase().replace(/ /g, '_'))
    // $('#sku' + id + '_id').val(productId + '_' + value.toLowerCase().replace(' ', '_'))
}

function appendSkuLabel(id, value) {
  var productId = $('input[name=product_id]').val()
    $('#sku' + id + '_id').val(productId + '_' + value.toLowerCase().replace(/ /g, '_'))

}


$('#deleteCoupon').on('click', function(){
        var c = $('#coupon').val
        console.log(c)
        $.ajax({
          type: 'POST',
          url: '/admin/coupon/delete',
          data: {id: c},
          success: function(res) {
            toastr['success']('coupon deleted')
            $('#deleteCouponModal').modal('hide')
          }
        })
      })


      $(document).on("click", ".delete-coupon", function () {
     var c = $(this).data('coupon');
     console.log(c)
     $(".modal-footer #coupon").val( c );
     // As pointed out in comments, 
     // it is unnecessary to have to manually call the modal.
     // $('#addBookDialog').modal('show');
});

function addSkuSection() {
  let id = parseInt($('.sku-form')[$('.sku-form').length - 1].id.replace('skuForm', ''))
  id += 1
  let template = '<section class="comSection comSection--light sku-form" id="skuForm'+id+'">\
            <h5 class="card-title">Sku Info</h5>\
            <form id="sku'+id+'">\
              <input class="sku-id muted" id="sku'+id+'_id" name="sku_id"/>\
              <div class="row">\
                <div class="col-md-4 col-lg-4 mx-auto">\
                  <div class="form-group">\
                    <input type="text" name="label" placeholder="Flavor/Color/Meat Variation" required class="form-control" onchange="appendSkuLabel('+id+', this.value)" />\
                  </div>\
                </div>\
                <div class="col-md-4 col-lg-4 mx-auto">\
                  <div class="form-group">\
                    <input type="text" name="price" placeholder="Price" required class="form-control">\
                  </div>\
                </div>\
              </div>\
              <div class="row">\
                <div class="col-md-2">\
                  <div class="form-group">\
                    <label>Calories</label>\
                    <input type="text" class="form-control" name="calories" placeholder="Calories">\
                  </div>\
                </div>\
                <div class="col-md-2">\
                  <div class="form-group">\
                    <label>Carbs</label>\
                    <input type="text" class="form-control" name="carbs" placeholder="Carbs">\
                  </div>\
                </div>\
                <div class="col-md-2">\
                  <div class="form-group">\
                    <label>Proteins</label>\
                    <input type="text" class="form-control" name="proteins" placeholder="Proteins">\
                  </div>\
                </div>\
                <div class="col-md-2">\
                  <div class="form-group">\
                    <label>Fats</label>\
                    <input type="text" class="form-control" name="fats" placeholder="Fats">\
                  </div>\
                </div>\
              </div>\
            </form>\
          </section>\
          <hr class="mb-3">'
          $('.sku-column').append(template)

}
  </script>